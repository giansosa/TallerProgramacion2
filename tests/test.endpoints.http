### ============================================
### Tests de Endpoints
### ============================================
### Nota: Los tests de autenticación requieren autenticación
### ============================================

@baseUrl = http://localhost:3000/api/v1

### ============================================
### Health Check
### ============================================

### GET Health Check
GET {{baseUrl}}/../health

### ============================================
### Autenticación
### ============================================

### POST - Registrar usuario
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}

### POST - Error: Username ya existe
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}

### POST - Error: Username muy corto
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "ab",
  "password": "password123"
}

### POST - Error: Password muy corto
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "testuser2",
  "password": "12345"
}

### POST - Login con credenciales válidas
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}

### POST - Error: Login con credenciales inválidas
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "wrongpassword"
}

### POST - Error: Login sin username
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "password": "password123"
}

### ============================================
### Productos - CRUD Básico (Sin Auth)
### ============================================

### POST - Crear producto
POST {{baseUrl}}/productos
Content-Type: application/json

{
  "producto": "Laptop HP Pavilion",
  "stockAmount": 10
}

### POST - Crear producto con fecha de ingreso
POST {{baseUrl}}/productos
Content-Type: application/json

{
  "producto": "Mouse Logitech",
  "stockAmount": 50,
  "fechaIngreso": "2024-01-15"
}

### POST - Crear producto con stock 0
POST {{baseUrl}}/productos
Content-Type: application/json

{
  "producto": "Teclado Mecánico",
  "stockAmount": 0
}

### POST - Error: Producto vacío
POST {{baseUrl}}/productos
Content-Type: application/json

{
  "producto": "",
  "stockAmount": 5
}

### POST - Error: Stock negativo
POST {{baseUrl}}/productos
Content-Type: application/json

{
  "producto": "Monitor Dell",
  "stockAmount": -5
}

### POST - Error: Stock no entero
POST {{baseUrl}}/productos
Content-Type: application/json

{
  "producto": "Monitor Dell",
  "stockAmount": 5.5
}

### GET - Listar todos los productos
GET {{baseUrl}}/productos

### GET - Obtener producto por ID (reemplazar :id con un ID válido)
GET {{baseUrl}}/productos/:id

### GET - Error: Producto no encontrado
GET {{baseUrl}}/productos/999999999999999999999999

### ============================================
### Productos - Operaciones Protegidas (Requieren Auth)
### ============================================

### PUT - Error: Actualizar sin autenticación (reemplazar :id con un ID válido)
PUT {{baseUrl}}/productos/:id
Content-Type: application/json

{
  "stockAmount": 20
}

### PUT - Actualizar con x-api-key (reemplazar :id con un ID válido)
PUT {{baseUrl}}/productos/:id
Content-Type: application/json
x-api-key: api-key-secreta-para-pruebas-12345

{
  "producto": "Laptop HP Pavilion Actualizado",
  "stockAmount": 15,
  "fechaIngreso": "2024-02-01"
}

### PUT - Actualizar con JWT (reemplazar :id con un ID válido y <TOKEN> con el token obtenido)
PUT {{baseUrl}}/productos/:id
Content-Type: application/json
Authorization: Bearer <TOKEN>

{
  "stockAmount": 25
}

### PUT - Error: Producto vacío con auth (reemplazar :id con un ID válido)
PUT {{baseUrl}}/productos/:id
Content-Type: application/json
x-api-key: api-key-secreta-para-pruebas-12345

{
  "producto": ""
}

### PUT - Error: Stock negativo con auth (reemplazar :id con un ID válido)
PUT {{baseUrl}}/productos/:id
Content-Type: application/json
x-api-key: api-key-secreta-para-pruebas-12345

{
  "stockAmount": -10
}

### DELETE - Error: Eliminar sin autenticación (reemplazar :id con un ID válido)
DELETE {{baseUrl}}/productos/:id

### DELETE - Eliminar con x-api-key (reemplazar :id con un ID válido)
DELETE {{baseUrl}}/productos/:id
x-api-key: api-key-secreta-para-pruebas-12345

### DELETE - Eliminar con JWT (reemplazar :id con un ID válido y <TOKEN> con el token obtenido)
DELETE {{baseUrl}}/productos/:id
Authorization: Bearer <TOKEN>

### DELETE - Error: Producto no encontrado con auth
DELETE {{baseUrl}}/productos/999999999999999999999999
x-api-key: api-key-secreta-para-pruebas-12345

### ============================================
### Tests de Rutas No Encontradas
### ============================================

### GET - Ruta no encontrada
GET {{baseUrl}}/ruta-inexistente

### POST - Ruta no encontrada
POST {{baseUrl}}/productos/ruta-inexistente
Content-Type: application/json

{
  "producto": "Test"
}

### ============================================
### Albums - API Externa y CSV
### ============================================

### GET - Obtener albums en CSV (consume API externa y genera CSV)
GET {{baseUrl}}/albums/csv

### ============================================
### Instrucciones para Generar Token JWT
### ============================================
###
### 1. Registrar un nuevo usuario:
###    POST http://localhost:3000/api/v1/auth/register
###    Body: { "username": "testuser", "password": "password123" }
###
### 2. Iniciar sesión y obtener el token:
###    POST http://localhost:3000/api/v1/auth/login
###    Body: { "username": "testuser", "password": "password123" }
###
### 3. Copiar el token de la respuesta y reemplazar <TOKEN> en los tests
###
### 4. Usar el token en el header:
###    Authorization: Bearer <TOKEN_OBTENIDO>
###
### Nota: El token JWT tiene una expiración de 24 horas por defecto
###
### ============================================
### Instrucciones para Usar x-api-key
### ============================================
###
### 1. La API key está configurada en .env como:
###    API_KEY=api-key-secreta-para-pruebas-12345
###
### 2. Usar el header en las requests:
###    x-api-key: api-key-secreta-para-pruebas-12345
###
### 3. Puedes cambiar AUTH_METHOD en .env a:
###    - api-key: Solo acepta x-api-key
###    - jwt: Solo acepta JWT
###    - both: Acepta ambos métodos
###
### ============================================
### Nota sobre el endpoint /api/v1/albums/csv
### ============================================
###
### Este endpoint:
### 1. Consume la API externa https://jsonplaceholder.typicode.com/albums
### 2. Toma los primeros 15 registros
### 3. Los convierte a CSV (columnas: userId, id, title)
### 4. Guarda el CSV en database/albums_15.csv
### 5. Devuelve el CSV con Content-Type: text/csv
###
### No requiere autenticación por defecto.
###
